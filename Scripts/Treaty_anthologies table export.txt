Step 1:

create view treaty_anthologies_pages_extended as 

(SELECT treaty.id as treaty_id, treaty_anthologies.id as anth_id, treaty_anthologies_pages.scan, treaty_anthologies_pages.page_num,
case when page_num = 1 then scan end as Pnr1,
case when page_num = 2 then scan end as Pnr2,
case when page_num = 3 then scan end as Pnr3,
case when page_num = 4 then scan end as Pnr4,
case when page_num = 5 then scan end as Pnr5,
case when page_num = 6 then scan end as Pnr6,
case when page_num = 7 then scan end as Pnr7,
case when page_num = 8 then scan end as Pnr8,
case when page_num = 9 then scan end as Pnr9,
case when page_num = 10 then scan end as Pnr10,
case when page_num = 11 then scan end as Pnr11,
case when page_num = 12 then scan end as Pnr12,
case when page_num = 13 then scan end as Pnr13,
case when page_num = 14 then scan end as Pnr14,
case when page_num = 15 then scan end as Pnr15,
case when page_num = 16 then scan end as Pnr16,
case when page_num = 17 then scan end as Pnr17,
case when page_num = 18 then scan end as Pnr18,
case when page_num = 19 then scan end as Pnr19,
case when page_num = 20 then scan end as Pnr20,
case when page_num = 21 then scan end as Pnr21,
case when page_num = 22 then scan end as Pnr22,
case when page_num = 23 then scan end as Pnr23,
case when page_num = 24 then scan end as Pnr24,
case when page_num = 25 then scan end as Pnr25,
case when page_num = 26 then scan end as Pnr26,
case when page_num = 27 then scan end as Pnr27,
case when page_num = 28 then scan end as Pnr28,
case when page_num = 29 then scan end as Pnr29,
case when page_num = 30 then scan end as Pnr30,
case when page_num = 31 then scan end as Pnr31,
case when page_num = 32 then scan end as Pnr32,
case when page_num = 33 then scan end as Pnr33,
case when page_num = 34 then scan end as Pnr34,
case when page_num = 35 then scan end as Pnr35,
case when page_num = 36 then scan end as Pnr36,
case when page_num = 37 then scan end as Pnr37,
case when page_num = 38 then scan end as Pnr38,
case when page_num = 39 then scan end as Pnr39,
case when page_num = 40 then scan end as Pnr40,
case when page_num = 41 then scan end as Pnr41,
case when page_num = 42 then scan end as Pnr42,
case when page_num = 43 then scan end as Pnr43,
case when page_num = 44 then scan end as Pnr44,
case when page_num = 45 then scan end as Pnr45,
case when page_num = 46 then scan end as Pnr46,
case when page_num = 47 then scan end as Pnr47,
case when page_num = 48 then scan end as Pnr48,
case when page_num = 49 then scan end as Pnr49,
case when page_num = 50 then scan end as Pnr50,
case when page_num = 51 then scan end as Pnr51,
case when page_num = 52 then scan end as Pnr52,
case when page_num = 53 then scan end as Pnr53,
case when page_num = 54 then scan end as Pnr54,
case when page_num = 55 then scan end as Pnr55,
case when page_num = 56 then scan end as Pnr56,
case when page_num = 57 then scan end as Pnr57,
case when page_num = 58 then scan end as Pnr58,
case when page_num = 59 then scan end as Pnr59,
case when page_num = 60 then scan end as Pnr60,
case when page_num = 61 then scan end as Pnr61,
case when page_num = 62 then scan end as Pnr62,
case when page_num = 63 then scan end as Pnr63,
case when page_num = 64 then scan end as Pnr64,
case when page_num = 65 then scan end as Pnr65,
case when page_num = 66 then scan end as Pnr66,
case when page_num = 67 then scan end as Pnr67,
case when page_num = 68 then scan end as Pnr68,
case when page_num = 69 then scan end as Pnr69


from _ieg_treaty as treaty
inner join _ieg_treaty_anthologies treaty_anthologies on treaty.id = treaty_anthologies.treaty
inner join _ieg_treaty_anthologies_pages treaty_anthologies_pages on treaty_anthologies.id = treaty_anthologies_pages.anthology
WHERE treaty.status = "active"
);

Select * from treaty_anthologies_pages_extended


Step 2:

create view treaty_anthologies_pages_extended_pivot as 
(select treaty_id, anth_id,
max(Pnr1) as Pnr1,
max(Pnr2) as Pnr2,
max(Pnr3) as Pnr3,
max(Pnr4) as Pnr4,
max(Pnr5) as Pnr5,
max(Pnr6) as Pnr6,
max(Pnr7) as Pnr7,
max(Pnr8) as Pnr8,
max(Pnr9) as Pnr9,
max(Pnr10) as Pnr10,
max(Pnr11) as Pnr11,
max(Pnr12) as Pnr12,
max(Pnr13) as Pnr13,
max(Pnr14) as Pnr14,
max(Pnr15) as Pnr15,
max(Pnr16) as Pnr16,
max(Pnr17) as Pnr17,
max(Pnr18) as Pnr18,
max(Pnr19) as Pnr19,
max(Pnr20) as Pnr20,
max(Pnr21) as Pnr21,
max(Pnr22) as Pnr22,
max(Pnr23) as Pnr23,
max(Pnr24) as Pnr24,
max(Pnr25) as Pnr25,
max(Pnr26) as Pnr26,
max(Pnr27) as Pnr27,
max(Pnr28) as Pnr28,
max(Pnr29) as Pnr29,
max(Pnr30) as Pnr30,
max(Pnr31) as Pnr31,
max(Pnr32) as Pnr32,
max(Pnr33) as Pnr33,
max(Pnr34) as Pnr34,
max(Pnr35) as Pnr35,
max(Pnr36) as Pnr36,
max(Pnr37) as Pnr37,
max(Pnr38) as Pnr38,
max(Pnr39) as Pnr39,
max(Pnr40) as Pnr40,
max(Pnr41) as Pnr41,
max(Pnr42) as Pnr42,
max(Pnr43) as Pnr43,
max(Pnr44) as Pnr44,
max(Pnr45) as Pnr45,
max(Pnr46) as Pnr46,
max(Pnr47) as Pnr47,
max(Pnr48) as Pnr48,
max(Pnr49) as Pnr49,
max(Pnr50) as Pnr50,
max(Pnr51) as Pnr51,
max(Pnr52) as Pnr52,
max(Pnr53) as Pnr53,
max(Pnr54) as Pnr54,
max(Pnr55) as Pnr55,
max(Pnr56) as Pnr56,
max(Pnr57) as Pnr57,
max(Pnr58) as Pnr58,
max(Pnr59) as Pnr59,
max(Pnr60) as Pnr60,
max(Pnr61) as Pnr61,
max(Pnr62) as Pnr62,
max(Pnr63) as Pnr63,
max(Pnr64) as Pnr64,
max(Pnr65) as Pnr65,
max(Pnr66) as Pnr66,
max(Pnr67) as Pnr67,
max(Pnr68) as Pnr68,
max(Pnr69) as Pnr69


from treaty_anthologies_pages_extended
group by treaty_anthologies_pages_extended.treaty_id, treaty_anthologies_pages_extended.anth_id);

select * from treaty_anthologies_pages_extended_pivot
