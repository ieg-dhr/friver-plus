Step 1:

create view treaty_pages_extended as 
(select treaty.id as treaty_id, treaty_pages.scan, treaty_pages.page_num,
case when page_num = 1 then scan end as Pnr1,
case when page_num = 2 then scan end as Pnr2,
case when page_num = 3 then scan end as Pnr3,
case when page_num = 4 then scan end as Pnr4,
case when page_num = 5 then scan end as Pnr5,
case when page_num = 6 then scan end as Pnr6,
case when page_num = 7 then scan end as Pnr7,
case when page_num = 8 then scan end as Pnr8,
case when page_num = 9 then scan end as Pnr9,
case when page_num = 10 then scan end as Pnr10,
case when page_num = 11 then scan end as Pnr11,
case when page_num = 12 then scan end as Pnr12,
case when page_num = 13 then scan end as Pnr13,
case when page_num = 14 then scan end as Pnr14,
case when page_num = 15 then scan end as Pnr15,
case when page_num = 16 then scan end as Pnr16,
case when page_num = 17 then scan end as Pnr17,
case when page_num = 18 then scan end as Pnr18,
case when page_num = 19 then scan end as Pnr19,
case when page_num = 20 then scan end as Pnr20,
case when page_num = 21 then scan end as Pnr21,
case when page_num = 22 then scan end as Pnr22,
case when page_num = 23 then scan end as Pnr23,
case when page_num = 24 then scan end as Pnr24,
case when page_num = 25 then scan end as Pnr25,
case when page_num = 26 then scan end as Pnr26,
case when page_num = 27 then scan end as Pnr27,
case when page_num = 28 then scan end as Pnr28,
case when page_num = 29 then scan end as Pnr29,
case when page_num = 30 then scan end as Pnr30,
case when page_num = 31 then scan end as Pnr31,
case when page_num = 32 then scan end as Pnr32,
case when page_num = 33 then scan end as Pnr33,
case when page_num = 34 then scan end as Pnr34,
case when page_num = 35 then scan end as Pnr35,
case when page_num = 36 then scan end as Pnr36,
case when page_num = 37 then scan end as Pnr37,
case when page_num = 38 then scan end as Pnr38,
case when page_num = 39 then scan end as Pnr39,
case when page_num = 40 then scan end as Pnr40,
case when page_num = 41 then scan end as Pnr41,
case when page_num = 42 then scan end as Pnr42,
case when page_num = 43 then scan end as Pnr43,
case when page_num = 44 then scan end as Pnr44,
case when page_num = 45 then scan end as Pnr45,
case when page_num = 46 then scan end as Pnr46,
case when page_num = 47 then scan end as Pnr47,
case when page_num = 48 then scan end as Pnr48,
case when page_num = 49 then scan end as Pnr49,
case when page_num = 50 then scan end as Pnr50,
case when page_num = 51 then scan end as Pnr51,
case when page_num = 52 then scan end as Pnr52,
case when page_num = 53 then scan end as Pnr53,
case when page_num = 54 then scan end as Pnr54,
case when page_num = 55 then scan end as Pnr55,
case when page_num = 56 then scan end as Pnr56,
case when page_num = 57 then scan end as Pnr57,
case when page_num = 58 then scan end as Pnr58,
case when page_num = 59 then scan end as Pnr59,
case when page_num = 60 then scan end as Pnr60,
case when page_num = 61 then scan end as Pnr61,
case when page_num = 62 then scan end as Pnr62,
case when page_num = 63 then scan end as Pnr63,
case when page_num = 64 then scan end as Pnr64,
case when page_num = 65 then scan end as Pnr65,
case when page_num = 66 then scan end as Pnr66,
case when page_num = 67 then scan end as Pnr67,
case when page_num = 68 then scan end as Pnr68,
case when page_num = 69 then scan end as Pnr69,
case when page_num = 70 then scan end as Pnr70,
case when page_num = 71 then scan end as Pnr71,
case when page_num = 72 then scan end as Pnr72,
case when page_num = 73 then scan end as Pnr73,
case when page_num = 74 then scan end as Pnr74,
case when page_num = 75 then scan end as Pnr75,
case when page_num = 76 then scan end as Pnr76,
case when page_num = 77 then scan end as Pnr77,
case when page_num = 78 then scan end as Pnr78,
case when page_num = 79 then scan end as Pnr79,
case when page_num = 80 then scan end as Pnr80,
case when page_num = 81 then scan end as Pnr81,
case when page_num = 82 then scan end as Pnr82,
case when page_num = 83 then scan end as Pnr83,
case when page_num = 84 then scan end as Pnr84,
case when page_num = 85 then scan end as Pnr85,
case when page_num = 86 then scan end as Pnr86,
case when page_num = 87 then scan end as Pnr87,
case when page_num = 88 then scan end as Pnr88,
case when page_num = 89 then scan end as Pnr89,
case when page_num = 90 then scan end as Pnr90,
case when page_num = 91 then scan end as Pnr91,
case when page_num = 92 then scan end as Pnr92,
case when page_num = 93 then scan end as Pnr93,
case when page_num = 94 then scan end as Pnr94,
case when page_num = 95 then scan end as Pnr95,
case when page_num = 96 then scan end as Pnr96,
case when page_num = 97 then scan end as Pnr97,
case when page_num = 98 then scan end as Pnr98,
case when page_num = 99 then scan end as Pnr99,
case when page_num = 100 then scan end as Pnr100,
case when page_num = 101 then scan end as Pnr101,
case when page_num = 102 then scan end as Pnr102,
case when page_num = 103 then scan end as Pnr103,
case when page_num = 104 then scan end as Pnr104,
case when page_num = 105 then scan end as Pnr105,
case when page_num = 106 then scan end as Pnr106,
case when page_num = 107 then scan end as Pnr107,
case when page_num = 108 then scan end as Pnr108,
case when page_num = 109 then scan end as Pnr109,
case when page_num = 110 then scan end as Pnr110,
case when page_num = 111 then scan end as Pnr111,
case when page_num = 112 then scan end as Pnr112,
case when page_num = 113 then scan end as Pnr113,
case when page_num = 114 then scan end as Pnr114,
case when page_num = 115 then scan end as Pnr115,
case when page_num = 116 then scan end as Pnr116,
case when page_num = 117 then scan end as Pnr117,
case when page_num = 118 then scan end as Pnr118,
case when page_num = 119 then scan end as Pnr119,
case when page_num = 120 then scan end as Pnr120,
case when page_num = 121 then scan end as Pnr121,
case when page_num = 122 then scan end as Pnr122,
case when page_num = 123 then scan end as Pnr123,
case when page_num = 124 then scan end as Pnr124,
case when page_num = 125 then scan end as Pnr125,
case when page_num = 126 then scan end as Pnr126,
case when page_num = 127 then scan end as Pnr127,
case when page_num = 128 then scan end as Pnr128,
case when page_num = 129 then scan end as Pnr129,
case when page_num = 130 then scan end as Pnr130,
case when page_num = 131 then scan end as Pnr131,
case when page_num = 132 then scan end as Pnr132,
case when page_num = 133 then scan end as Pnr133,
case when page_num = 134 then scan end as Pnr134,
case when page_num = 135 then scan end as Pnr135,
case when page_num = 136 then scan end as Pnr136,
case when page_num = 137 then scan end as Pnr137,
case when page_num = 138 then scan end as Pnr138,
case when page_num = 139 then scan end as Pnr139,
case when page_num = 140 then scan end as Pnr140,
case when page_num = 141 then scan end as Pnr141,
case when page_num = 142 then scan end as Pnr142,
case when page_num = 143 then scan end as Pnr143,
case when page_num = 144 then scan end as Pnr144,
case when page_num = 145 then scan end as Pnr145,
case when page_num = 146 then scan end as Pnr146,
case when page_num = 147 then scan end as Pnr147,
case when page_num = 148 then scan end as Pnr148,
case when page_num = 149 then scan end as Pnr149,
case when page_num = 150 then scan end as Pnr150,
case when page_num = 151 then scan end as Pnr151,
case when page_num = 152 then scan end as Pnr152,
case when page_num = 153 then scan end as Pnr153,
case when page_num = 154 then scan end as Pnr154,
case when page_num = 155 then scan end as Pnr155,
case when page_num = 156 then scan end as Pnr156,
case when page_num = 157 then scan end as Pnr157,
case when page_num = 158 then scan end as Pnr158,
case when page_num = 159 then scan end as Pnr159,
case when page_num = 160 then scan end as Pnr160,
case when page_num = 161 then scan end as Pnr161,
case when page_num = 162 then scan end as Pnr162,
case when page_num = 163 then scan end as Pnr163,
case when page_num = 164 then scan end as Pnr164,
case when page_num = 165 then scan end as Pnr165,
case when page_num = 166 then scan end as Pnr166,
case when page_num = 167 then scan end as Pnr167,
case when page_num = 168 then scan end as Pnr168,
case when page_num = 169 then scan end as Pnr169,
case when page_num = 170 then scan end as Pnr170,
case when page_num = 171 then scan end as Pnr171,
case when page_num = 172 then scan end as Pnr172,
case when page_num = 173 then scan end as Pnr173,
case when page_num = 174 then scan end as Pnr174,
case when page_num = 175 then scan end as Pnr175,
case when page_num = 176 then scan end as Pnr176,
case when page_num = 177 then scan end as Pnr177,
case when page_num = 178 then scan end as Pnr178,
case when page_num = 179 then scan end as Pnr179,
case when page_num = 180 then scan end as Pnr180,
case when page_num = 181 then scan end as Pnr181,
case when page_num = 182 then scan end as Pnr182,
case when page_num = 183 then scan end as Pnr183,
case when page_num = 184 then scan end as Pnr184,
case when page_num = 185 then scan end as Pnr185,
case when page_num = 186 then scan end as Pnr186,
case when page_num = 187 then scan end as Pnr187,
case when page_num = 188 then scan end as Pnr188,
case when page_num = 189 then scan end as Pnr189,
case when page_num = 190 then scan end as Pnr190,
case when page_num = 191 then scan end as Pnr191,
case when page_num = 192 then scan end as Pnr192,
case when page_num = 193 then scan end as Pnr193,
case when page_num = 194 then scan end as Pnr194,
case when page_num = 195 then scan end as Pnr195,
case when page_num = 196 then scan end as Pnr196,
case when page_num = 197 then scan end as Pnr197,
case when page_num = 198 then scan end as Pnr198,
case when page_num = 199 then scan end as Pnr199,
case when page_num = 200 then scan end as Pnr200,
case when page_num = 201 then scan end as Pnr201,
case when page_num = 202 then scan end as Pnr202,
case when page_num = 203 then scan end as Pnr203,
case when page_num = 204 then scan end as Pnr204,
case when page_num = 205 then scan end as Pnr205,
case when page_num = 206 then scan end as Pnr206,
case when page_num = 207 then scan end as Pnr207,
case when page_num = 208 then scan end as Pnr208,
case when page_num = 209 then scan end as Pnr209

from _ieg_treaty as treaty
inner join _ieg_treaty_pages treaty_pages on treaty.id = treaty_pages.treaty
WHERE treaty.status = "active"
);

select * from treaty_pages_extended



Step 2:

create view treaty_pages_extended_pivot as 
(select treaty_id, 
max(Pnr1) as Pnr1,
max(Pnr2) as Pnr2,
max(Pnr3) as Pnr3,
max(Pnr4) as Pnr4,
max(Pnr5) as Pnr5,
max(Pnr6) as Pnr6,
max(Pnr7) as Pnr7,
max(Pnr8) as Pnr8,
max(Pnr9) as Pnr9,
max(Pnr10) as Pnr10,
max(Pnr11) as Pnr11,
max(Pnr12) as Pnr12,
max(Pnr13) as Pnr13,
max(Pnr14) as Pnr14,
max(Pnr15) as Pnr15,
max(Pnr16) as Pnr16,
max(Pnr17) as Pnr17,
max(Pnr18) as Pnr18,
max(Pnr19) as Pnr19,
max(Pnr20) as Pnr20,
max(Pnr21) as Pnr21,
max(Pnr22) as Pnr22,
max(Pnr23) as Pnr23,
max(Pnr24) as Pnr24,
max(Pnr25) as Pnr25,
max(Pnr26) as Pnr26,
max(Pnr27) as Pnr27,
max(Pnr28) as Pnr28,
max(Pnr29) as Pnr29,
max(Pnr30) as Pnr30,
max(Pnr31) as Pnr31,
max(Pnr32) as Pnr32,
max(Pnr33) as Pnr33,
max(Pnr34) as Pnr34,
max(Pnr35) as Pnr35,
max(Pnr36) as Pnr36,
max(Pnr37) as Pnr37,
max(Pnr38) as Pnr38,
max(Pnr39) as Pnr39,
max(Pnr40) as Pnr40,
max(Pnr41) as Pnr41,
max(Pnr42) as Pnr42,
max(Pnr43) as Pnr43,
max(Pnr44) as Pnr44,
max(Pnr45) as Pnr45,
max(Pnr46) as Pnr46,
max(Pnr47) as Pnr47,
max(Pnr48) as Pnr48,
max(Pnr49) as Pnr49,
max(Pnr50) as Pnr50,
max(Pnr51) as Pnr51,
max(Pnr52) as Pnr52,
max(Pnr53) as Pnr53,
max(Pnr54) as Pnr54,
max(Pnr55) as Pnr55,
max(Pnr56) as Pnr56,
max(Pnr57) as Pnr57,
max(Pnr58) as Pnr58,
max(Pnr59) as Pnr59,
max(Pnr60) as Pnr60,
max(Pnr61) as Pnr61,
max(Pnr62) as Pnr62,
max(Pnr63) as Pnr63,
max(Pnr64) as Pnr64,
max(Pnr65) as Pnr65,
max(Pnr66) as Pnr66,
max(Pnr67) as Pnr67,
max(Pnr68) as Pnr68,
max(Pnr69) as Pnr69,
max(Pnr70) as Pnr70,
max(Pnr71) as Pnr71,
max(Pnr72) as Pnr72,
max(Pnr73) as Pnr73,
max(Pnr74) as Pnr74,
max(Pnr75) as Pnr75,
max(Pnr76) as Pnr76,
max(Pnr77) as Pnr77,
max(Pnr78) as Pnr78,
max(Pnr79) as Pnr79,
max(Pnr80) as Pnr80,
max(Pnr81) as Pnr81,
max(Pnr82) as Pnr82,
max(Pnr83) as Pnr83,
max(Pnr84) as Pnr84,
max(Pnr85) as Pnr85,
max(Pnr86) as Pnr86,
max(Pnr87) as Pnr87,
max(Pnr88) as Pnr88,
max(Pnr89) as Pnr89,
max(Pnr90) as Pnr90,
max(Pnr91) as Pnr91,
max(Pnr92) as Pnr92,
max(Pnr93) as Pnr93,
max(Pnr94) as Pnr94,
max(Pnr95) as Pnr95,
max(Pnr96) as Pnr96,
max(Pnr97) as Pnr97,
max(Pnr98) as Pnr98,
max(Pnr99) as Pnr99,
max(Pnr100) as Pnr100,
max(Pnr101) as Pnr101,
max(Pnr102) as Pnr102,
max(Pnr103) as Pnr103,
max(Pnr104) as Pnr104,
max(Pnr105) as Pnr105,
max(Pnr106) as Pnr106,
max(Pnr107) as Pnr107,
max(Pnr108) as Pnr108,
max(Pnr109) as Pnr109,
max(Pnr110) as Pnr110,
max(Pnr111) as Pnr111,
max(Pnr112) as Pnr112,
max(Pnr113) as Pnr113,
max(Pnr114) as Pnr114,
max(Pnr115) as Pnr115,
max(Pnr116) as Pnr116,
max(Pnr117) as Pnr117,
max(Pnr118) as Pnr118,
max(Pnr119) as Pnr119,
max(Pnr120) as Pnr120,
max(Pnr121) as Pnr121,
max(Pnr122) as Pnr122,
max(Pnr123) as Pnr123,
max(Pnr124) as Pnr124,
max(Pnr125) as Pnr125,
max(Pnr126) as Pnr126,
max(Pnr127) as Pnr127,
max(Pnr128) as Pnr128,
max(Pnr129) as Pnr129,
max(Pnr130) as Pnr130,
max(Pnr131) as Pnr131,
max(Pnr132) as Pnr132,
max(Pnr133) as Pnr133,
max(Pnr134) as Pnr134,
max(Pnr135) as Pnr135,
max(Pnr136) as Pnr136,
max(Pnr137) as Pnr137,
max(Pnr138) as Pnr138,
max(Pnr139) as Pnr139,
max(Pnr140) as Pnr140,
max(Pnr141) as Pnr141,
max(Pnr142) as Pnr142,
max(Pnr143) as Pnr143,
max(Pnr144) as Pnr144,
max(Pnr145) as Pnr145,
max(Pnr146) as Pnr146,
max(Pnr147) as Pnr147,
max(Pnr148) as Pnr148,
max(Pnr149) as Pnr149,
max(Pnr150) as Pnr150,
max(Pnr151) as Pnr151,
max(Pnr152) as Pnr152,
max(Pnr153) as Pnr153,
max(Pnr154) as Pnr154,
max(Pnr155) as Pnr155,
max(Pnr156) as Pnr156,
max(Pnr157) as Pnr157,
max(Pnr158) as Pnr158,
max(Pnr159) as Pnr159,
max(Pnr160) as Pnr160,
max(Pnr161) as Pnr161,
max(Pnr162) as Pnr162,
max(Pnr163) as Pnr163,
max(Pnr164) as Pnr164,
max(Pnr165) as Pnr165,
max(Pnr166) as Pnr166,
max(Pnr167) as Pnr167,
max(Pnr168) as Pnr168,
max(Pnr169) as Pnr169,
max(Pnr170) as Pnr170,
max(Pnr171) as Pnr171,
max(Pnr172) as Pnr172,
max(Pnr173) as Pnr173,
max(Pnr174) as Pnr174,
max(Pnr175) as Pnr175,
max(Pnr176) as Pnr176,
max(Pnr177) as Pnr177,
max(Pnr178) as Pnr178,
max(Pnr179) as Pnr179,
max(Pnr180) as Pnr180,
max(Pnr181) as Pnr181,
max(Pnr182) as Pnr182,
max(Pnr183) as Pnr183,
max(Pnr184) as Pnr184,
max(Pnr185) as Pnr185,
max(Pnr186) as Pnr186,
max(Pnr187) as Pnr187,
max(Pnr188) as Pnr188,
max(Pnr189) as Pnr189,
max(Pnr190) as Pnr190,
max(Pnr191) as Pnr191,
max(Pnr192) as Pnr192,
max(Pnr193) as Pnr193,
max(Pnr194) as Pnr194,
max(Pnr195) as Pnr195,
max(Pnr196) as Pnr196,
max(Pnr197) as Pnr197,
max(Pnr198) as Pnr198,
max(Pnr199) as Pnr199,
max(Pnr200) as Pnr200,
max(Pnr201) as Pnr201,
max(Pnr202) as Pnr202,
max(Pnr203) as Pnr203,
max(Pnr204) as Pnr204,
max(Pnr205) as Pnr205,
max(Pnr206) as Pnr206,
max(Pnr207) as Pnr207,
max(Pnr208) as Pnr208,
max(Pnr209) as Pnr209

from treaty_pages_extended
group by treaty_pages_extended.treaty_id);

select * from treaty_pages_extended_pivot
